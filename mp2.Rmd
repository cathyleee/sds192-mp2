---
title: "Mini-Project 2"
author: "Your Name Here"
date: "October 31, 2017"
output: html_document
---
### Loading the data
```{r, include = FALSE}
library(tidyverse)
library(RColorBrewer)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

### Wrangle the data
```{r}
# join the contributions and candidates tables by cand_id
contributions_2012 <- contributions %>% 
  inner_join(candidates, by = "cand_id") %>%
  filter(cand_election_yr == 2012) %>% # filter only elections in 2012
  filter(transaction_type == "24E") %>% # filter only advocating donations
  select(cand_party_affiliation, cand_id, transaction_amt, other_id) %>%
  group_by(cand_id) %>%
  summarize(N = n(),
            total_amt_per_can = sum(transaction_amt))
nrow(contributions_2012)
```

```{r}
# join contributions_2012 and house_elections tables by fec_id = cand_id
contributions_2012 <- contributions_2012 %>%
  inner_join(house_elections, by = c("cand_id" = "fec_id"))
nrow(contributions_2012)
```

### Make the first data graphic about the relationship between amount of advocating donations received and number of votes received
```{r}
plot1 <- contributions_2012 %>%
  ggplot(aes(x = total_amt_per_can)) +
  geom_line(aes(y = general_votes), col = rgb(224/255, 94/255, 135/255)) +
  geom_line(aes(y = primary_votes), col = rgb(110/255, 158/255, 204/255)) +
  geom_line(aes(y = runoff_votes), col = rgb(123/255, 83/255, 160/255)) 
plot1
```


```{r}
# because one candidate can receive multiple donations
# but only has one number of votes
# so we group by cand_id to find the total amount of money one candidate received
contributions_2012_per_party <- contributions_2012 %>%
  group_by(party) %>%
  summarize(num_can = n(),
            total_amt = sum(total_amt_per_can),
            mean_amt = mean(total_amt_per_can),
            total_votes = sum(general_votes), 
            mean_votes = mean(general_votes),
            num_win = sum(ifelse(ge_winner == "W", 1, 0))) %>%
  arrange(desc(total_votes))
```

## Make data graphic
```{r, warning = FALSE}
plot2 <- contributions_2012_per_party %>%
  ggplot(aes(x = reorder(party, -total_votes))) +
  geom_histogram(aes(y = total_votes), stat = "identity", fill = rgb(108/255, 185/255, 209/255)) +
  geom_histogram(aes(y = total_amt), stat = "identity", fill = rgb(224/255, 132/255, 13/255), width = 0.5) +
  scale_y_continuous(sec.axis = sec_axis(~.*1, name = "Mean transaction amount per candidate (US$)")) # ask Ben about the unit
plot2
```

```{r, warning = FALSE}
contributions_2012_per_party %>% arrange(desc(mean_votes))
plot3 <- contributions_2012_per_party %>%
  ggplot(aes(x = reorder(party, -mean_votes))) +
  geom_histogram(aes(y = mean_votes), stat = "identity", fill = rgb(108/255, 185/255, 209/255)) +
  geom_histogram(aes(y = mean_amt), stat = "identity", fill = rgb(224/255, 132/255, 13/255), width = 0.5) +
  scale_y_continuous(sec.axis = sec_axis(~.*1, name = "Mean transaction amount per candidate (US$)")) # ask Ben about the unit
plot3
```
